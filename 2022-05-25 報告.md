# 電路組

---

## 光達

光達供電解決

---

## 電力供應

- 給底盤的航模電池型號確定
- 接下來做測試，使用電供確認規格正確

---

## 電路板

- 電路板畫出來了，優化中
- 機構組提供兩種飛輪，電路板兩種都畫好了

---

![[附件/circuit board 2022-05-23.png]]

上為其中一種電路板

---

# 軟體組

---

## 測距

1. 鏡頭找不到廠商
2. 距離辨識焦距會亂跳，還在優化

---

## 字母辨識

- 字母辨識已經完成了，但效率不高
- 正在優化

---

## 點字

- 點字辨識已經完成
- 目前正在打包成 package

---

## 硬體模擬小車

![[Pasted image 20220525024338.png]]

---

目的：

1. 測試stm32和電腦的通訊
2. 作為影像辨識or光達演算法的實際驗證
3. 作為ros整合教材（供學弟妹學習）

---

## 導航

1. 組裝小車並進行測試
2. Hector SLAM 演算法測試
3. 小車 ROS 安裝

---

<video src="C:\Users\drevi\Documents\things\My-Vault\附件\lidar 2.mp4" controls width="640">
</video>

---

### 下周進度

1. UART 傳輸
2. SSH 遠端

---

### 遭遇問題

- 樹莓派算力有限，不堪負荷

![[Pasted image 20220525025213.png]]

---

### Lidar 進度

和老師借的 LiDAR 會在週四由歐庭維和林宗佑進行測試，主要測試目標如下：
1. 在有小範圍格擋的情況下是否能維持SLAM精準度
2. 機體轉動＆移動的最高極限
3. LIDAR獨立供電及底盤馬達的控制（蕭定緯）

---

## STM32 進度

- 基本gpio控制
- Pwm輸出
- Timer interrupt
- Uart輸出輸入
- linux端uart輸入
- 利用外部中斷讀取encoder
- 利用timer的encoder_mode讀取encoder

---

### 接下來的目標

- Linux端的uart輸出
- 馬達轉速pid控制(已完成程式撰寫但尚未測試)
- 底盤位置控制
- stm32和板載電腦的通訊編碼設計

---

### STM32_GPIO 基本功能

- GPIO腳位輸出
- GPIO腳位讀取
- PWM輸出

<video src="C:\Users\drevi\Documents\things\My-Vault\附件\馬達_demo.mp4?autoplay=0" controls width="640">
</video>

---

### 使用外部中斷讀取 encoder

![[Pasted image 20220525095037.png]]

---

![[Pasted image 20220525095205.png]]

---

### 使用外部中斷讀取 encoder_Demo

<video src="C:\Users\drevi\Documents\things\My-Vault\附件\pid and lidar demo.mp4?autoplay=0" controls width="350">
</video>

---

### 利用 timer 的 encoder_mode 讀取 encoder

![[Pasted image 20220525095353.png]]
![[Pasted image 20220525095401.png]]

---

### STM32_Uart

- 中斷接收
- 中斷輸出
- 阻塞接收
- 阻塞輸出
- 字串轉換後送出
- 接收後解析資料

---

![[Pasted image 20220525095440.png]]

---

### Linux_Uart

- 在c語言的環境下使用 `termios.h` 中的函式讀取 uart 資料
- 正在研究如何發送 uart 資料

![[Pasted image 20220525095531.png]]

---

### Uart_demo 影片

![[usart_linux_receive_demo.mp4]]

---

### 馬達轉速 pid 控制器說明

需要此控制器的原因

- 避免不同輪子的轉速差導致底盤航
- 避免因為重量分配不均導致輪子轉速不同

---

### 前提假設

- <font size = "4">馬達轉速是由pwm訊號的占空比決定</font>
- <font size = "4">馬達轉速和占空比成線性關係，這裡假設其比率為 $1\% = 0.1 \text{ round}/\text{sec }$</font>
- <font size = "4">Pid控制器的取樣及週期均由 timer 控制，其週期為 $0.1$ 秒</font>
<font size = "4">每 $0.1$ 秒會去比對 encoder 的位置變化，計算出當前速度後，進行一次 pid 控制</font>


---

### pid 控制流程說明

![[Pasted image 20220525101344.png]]

<font size = "4">由於目標轉速為 $5 \text{ round}/\text{sec }$
所以啟動時的 pwm 訊號占空比為 $\text{ 50\%}$
此次說明為 $t = 0.1$ 時控制器的操作流程</font>

---

![[Pasted image 20220525101502.png]]
	
<font size = "4">

控制器的計算輸出值為pwm占空比的變化量

$$\text{Output} = (-1)\left(k_p\cdot(-2)+ k_i\cdot(\text{過去10筆的誤差})-k_d\cdot\left(\frac{-2-0}{0.1}\right)\right)$$

假使 $\text{output} = 1.3$

</font>

---

![[Pasted image 20220525101716.png]]

<font size = "4">

因為 pid 控制器的 output 為 $+1.3 \text{ round}/\text{sec }$

所以輸出轉速要增加為 $6.3 \text{ round}/\text{sec }$
也就會導致 pwm 占空比變為 $63\%$

</font>

---

![[Pasted image 20220525101829.png]]

<font size = "4">

則在 $t = 0.2$ 時，
由於輸出轉速變為 $6.3 \text{ round}/\text{sec }$
所以測得的轉速變為 $5.5 \text{ round}/\text{sec }$

</font>

---

![[Pasted image 20220525101932.png]]

<font size = "4">

控制器的計算輸出值為pwm占空比的變化量

$$\text{Output} = (-1)\left(k_p\cdot(0.5)+ k_i\cdot(0.5+(-2))-k_d\cdot\left(\frac{0.5-(-2)}{0.1}\right)\right)$$

假使output = -0.3
	
</font>

---

![[Pasted image 20220525102130.png]]

<font size = "4">

因為 pid 控制器的 output 為 $-0.3 \text{ round}/\text{sec }$

所以輸出轉速要減少為 $6 \text{ round}/\text{sec }$
也就會導致 pwm 占空比變為 $60\%$

</font>

---

### 位置控制器

- 決定速度控制器的方向和控制時長
- 在目標點附近設置死區，避免過度修正，會回傳真實座標給板載電腦

---

## 顏色辨識

- 顏色辨識完成

---

# 硬體組

![[附件/硬體組規劃表.png]]

---

- 場地建模完成

---

- 車子底盤建模完成

---

- 討論輪子飛輪該用什麼型號，目前正在建模

---

- 車子的其他部分在建模

---

- 這周或下周開始實體場地製作

---

因為實際的車子材料正在等到貨
因此作了小車替代

---

<img src="C:\Users\drevi\Documents\things\My-Vault\附件\小車.jpg" width="500">